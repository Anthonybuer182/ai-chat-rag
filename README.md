# RAG çŸ¥è¯†åº“ç³»ç»Ÿ

[![GitHub](https://img.shields.io/badge/GitHub-Repository-blue?logo=github)](https://github.com/Anthonybuer182/ai-chat-rag)

ä¸€ä¸ªåŸºäº FastAPI + WebSocket + ChromaDB + LLM çš„æ™ºèƒ½æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰çŸ¥è¯†åº“ç³»ç»Ÿï¼Œæ”¯æŒæ–‡æ¡£ä¸Šä¼ ã€æ™ºèƒ½æœç´¢å’Œå¯¹è¯å¼é—®ç­”ã€‚

<p align="center">
  <!-- GitHub ä¸ä¼šæ¸²æŸ“è§†é¢‘æ ‡ç­¾ï¼Œæ˜¾ç¤ºå›¾ç‰‡ä½œä¸ºæ›¿ä»£ -->
  <img src="assets/RAG.gif" alt="RAG ç³»ç»Ÿæ¼”ç¤º" width="800">
</p>

<p align="center">
  <!-- ä¿ç•™è§†é¢‘æ ‡ç­¾ç»™å…¶ä»–å¹³å°ä½¿ç”¨ -->
  <video width="800" controls style="display:none;">
    <source src="https://anthonybuer182.github.io/ai-chat-rag/RAG.mp4" type="video/mp4">
    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
  </video>
</p>

> - [ğŸ“º ç‚¹å‡»è¿™é‡Œç›´æ¥è§‚çœ‹è§†é¢‘](https://anthonybuer182.github.io/ai-chat-rag/RAG.mp4)

## ğŸŒŸ åŠŸèƒ½ç‰¹æ€§

### ğŸ“š æ–‡æ¡£ç®¡ç†
- **å¤šæ ¼å¼æ”¯æŒ**: æ”¯æŒ TXT, MD, HTML ç­‰æ ¼å¼
- **æ™ºèƒ½åˆ†å—**: è‡ªåŠ¨å°†æ–‡æ¡£åˆ†å‰²æˆè¯­ä¹‰å®Œæ•´çš„æ–‡æœ¬å—
- **å‘é‡å­˜å‚¨**: ä½¿ç”¨ ChromaDB å­˜å‚¨æ–‡æ¡£å‘é‡åµŒå…¥
- **é‡å¤æ£€æµ‹**: é˜²æ­¢é‡å¤ä¸Šä¼ ç›¸åŒæ–‡æ¡£
- **æ–‡æ¡£é¢„è§ˆ**: åœ¨çº¿æŸ¥çœ‹æ–‡æ¡£å†…å®¹
- **æœç´¢åŠŸèƒ½**: å…³é”®è¯æœç´¢æ–‡æ¡£å†…å®¹

### ğŸ’¬ æ™ºèƒ½å¯¹è¯
- **WebSocket å®æ—¶é€šä¿¡**: æä¾›æµç•…çš„å¯¹è¯ä½“éªŒ
- **å¤šæ–‡æ¡£é€‰æ‹©**: å¯é€‰æ‹©å¤šä¸ªæ–‡æ¡£ä½œä¸ºçŸ¥è¯†æ¥æº
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: åŸºäºä¸Šä¼ çš„æ–‡æ¡£å†…å®¹è¿›è¡Œæ™ºèƒ½å›ç­”
- **æµå¼å“åº”**: å®æ—¶æ˜¾ç¤ºAIç”Ÿæˆå†…å®¹
- **Markdown æ¸²æŸ“**: æ”¯æŒå¯Œæ–‡æœ¬æ ¼å¼æ˜¾ç¤º

### ğŸ” é«˜çº§æ£€ç´¢
- **å‘é‡å¬å›**: ç»“åˆåµŒå…¥ç›¸ä¼¼åº¦å’Œè¯­ä¹‰æ£€ç´¢
- **é‡æ’ä¼˜åŒ–**: ä½¿ç”¨äº¤å‰ç¼–ç å™¨æå‡ç»“æœç›¸å…³æ€§
- **ä¸­æ–‡ä¼˜åŒ–**: é’ˆå¯¹ä¸­æ–‡å†…å®¹ä¼˜åŒ–çš„åµŒå…¥æ¨¡å‹

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯
- **FastAPI**: é«˜æ€§èƒ½ Python Web æ¡†æ¶
- **WebSocket**: å®æ—¶åŒå‘é€šä¿¡
- **ChromaDB**: å‘é‡æ•°æ®åº“
- **Sentence Transformers**: æ–‡æœ¬åµŒå…¥æ¨¡å‹
- **Cross Encoder**: é‡æ’æ¨¡å‹
- **SQLite**: æ–‡æ¡£å…ƒæ•°æ®å­˜å‚¨

### å‰ç«¯
- **HTML5 + CSS3**: ç°ä»£åŒ–å“åº”å¼ç•Œé¢
- **JavaScript ES6+**: äº¤äº’é€»è¾‘
- **WebSocket API**: å®æ—¶é€šä¿¡
- **Marked.js**: Markdown æ¸²æŸ“
- **Font Awesome**: å›¾æ ‡åº“

### AI é›†æˆ
- **DeepSeek API**: å¤§è¯­è¨€æ¨¡å‹æœåŠ¡
- **é˜¿é‡Œç™¾ç‚¼åµŒå…¥æ¨¡å‹**: text-embedding-v4 (ä¸­æ–‡ä¼˜åŒ–)
- **é˜¿é‡Œç™¾ç‚¼é‡æ’æ¨¡å‹**: gte-rerank-v2

## ğŸ“¦ å®‰è£…éƒ¨ç½²

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- pip 20.0+

### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/Anthonybuer182/ai-chat-rag.git
cd ai-chat-rag
```

### 2. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 3. é…ç½®ç¯å¢ƒå˜é‡
å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿æ–‡ä»¶ï¼š
```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶å¹¶è®¾ç½® API å¯†é’¥ï¼š
```bash
# DeepSeek API é…ç½®
API_KEY=your_deepseek_api_key_here
BASE_URL=https://api.deepseek.com/v1
MODEL=deepseek-chat

# é˜¿é‡Œç™¾ç‚¼ API é…ç½®
DASHSCOPE_API_KEY=your_dashscope_api_key_here
# å¯é€‰ï¼šå¦‚æœä½¿ç”¨æ–°åŠ å¡åœ°åŸŸï¼Œå–æ¶ˆæ³¨é‡Šä¸‹é¢ä¸€è¡Œ
# BASE_URL_BAILIAN=https://dashscope-intl.aliyuncs.com/compatible-mode/v1
```

> **æ³¨æ„**: é¡¹ç›®éœ€è¦ DeepSeek API å’Œé˜¿é‡Œç™¾ç‚¼ APIï¼Œéœ€è¦æ³¨å†Œå¹¶è·å– API å¯†é’¥
> 
> **è·å– DeepSeek API å¯†é’¥**: è®¿é—® [DeepSeek å¹³å°](https://platform.deepseek.com/api_keys) æ³¨å†Œè´¦å·å¹¶è·å– API å¯†é’¥
> 
> **è·å– é˜¿é‡Œç™¾ç‚¼ API å¯†é’¥**: è®¿é—® [é˜¿é‡Œç™¾ç‚¼å¹³å°](https://bailian.console.aliyun.com/?tab=model#/api-key) æ³¨å†Œè´¦å·å¹¶è·å– API å¯†é’¥

### 4. å¯åŠ¨åº”ç”¨
```bash
python main.py
```

åº”ç”¨å°†åœ¨ `http://0.0.0.0:8000` å¯åŠ¨ï¼Œè®¿é—®è¯¥åœ°å€å³å¯ä½¿ç”¨ã€‚


## ğŸš€ ä½¿ç”¨æŒ‡å—

### ä¸Šä¼ æ–‡æ¡£
1. ç‚¹å‡»"æ–‡æ¡£ç®¡ç†"æ ‡ç­¾é¡µ
2. æ‹–æ‹½æ–‡ä»¶åˆ°ä¸Šä¼ åŒºåŸŸæˆ–ç‚¹å‡»"é€‰æ‹©æ–‡ä»¶"
3. ç³»ç»Ÿè‡ªåŠ¨å¤„ç†æ–‡æ¡£å¹¶æ„å»ºå‘é‡ç´¢å¼•

### æ™ºèƒ½å¯¹è¯
1. ç‚¹å‡»"æ™ºèƒ½èŠå¤©"æ ‡ç­¾é¡µ  
2. é€‰æ‹©è¦å‚è€ƒçš„æ–‡æ¡£ï¼ˆå¯é€‰ï¼‰
3. è¾“å…¥é—®é¢˜å¹¶å‘é€
4. AI å°†åŸºäºæ‰€é€‰æ–‡æ¡£å†…å®¹å›ç­”

### æ–‡æ¡£æœç´¢
1. åœ¨æ–‡æ¡£ç®¡ç†é¡µé¢ç‚¹å‡»æœç´¢å›¾æ ‡
2. è¾“å…¥å…³é”®è¯æœç´¢æ–‡æ¡£å†…å®¹
3. æŸ¥çœ‹ç›¸å…³åº¦æ’åºçš„æœç´¢ç»“æœ

## ğŸ“ é¡¹ç›®ç»“æ„

### ç›®å½•ç»“æ„
```
ai-chat-rag/
â”œâ”€â”€ main.py                 # ä¸»åº”ç”¨æ–‡ä»¶
â”œâ”€â”€ requirements.txt        # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ text_chunk.py          # æ–‡æœ¬åˆ†å—å¤„ç†
â”œâ”€â”€ app.log                # åº”ç”¨æ—¥å¿—
â”œâ”€â”€ .gitignore            # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ data/                 # æ•°æ®å­˜å‚¨ç›®å½•
â”‚   â”œâ”€â”€ chroma/          # ChromaDB æ•°æ®
â”‚   â””â”€â”€ knowledge_base.db # SQLite æ•°æ®åº“
â”œâ”€â”€ static/              # é™æ€æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ uploads/         # ä¸Šä¼ æ–‡ä»¶å­˜å‚¨
â”œâ”€â”€ templates/           # æ¨¡æ¿æ–‡ä»¶
â”‚   â””â”€â”€ index.html       # å‰ç«¯é¡µé¢
â””â”€â”€ utils/               # å·¥å…·æ¨¡å—
    â”œâ”€â”€ __init__.py
    â””â”€â”€ stream_llm.py    # LLM æµå¼å¤„ç†
```
### çŸ¥è¯†åº“æ¶æ„å›¾
```mermaid
flowchart TD
    %% å·¦ä¾§åˆ— - æ–‡æ¡£å¤„ç†æµç¨‹
    subgraph LeftColumn [æ–‡æ¡£å¤„ç†æµç¨‹]
        direction TB
        A1[ğŸ“„ æ–‡æ¡£å¯¼å…¥] --> A2[æ–‡æ¡£åŠ è½½ä¸è§£æ]
        A2 --> A3[æ–‡æœ¬åˆ†å‰²<br>Text Splitting]
        A3 --> A4[æ–‡æœ¬å‘é‡åŒ–<br>Embedding]
        A4 --> A5[å‘é‡å­˜å‚¨]
    end

    %% ä¸­é—´åˆ— - å‘é‡æ•°æ®åº“
    subgraph MiddleColumn [å‘é‡æ•°æ®åº“]
        direction TB
        DB[(å‘é‡æ•°æ®åº“<br>Vector Store)]
    end
    
    %% å³ä¾§åˆ— - æŸ¥è¯¢ä¸å“åº”æµç¨‹
    subgraph RightColumn [æŸ¥è¯¢ä¸å“åº”æµç¨‹]
        direction TB
        B1[â“ ç”¨æˆ·è¾“å…¥æŸ¥è¯¢] --> B3[æŸ¥è¯¢å‘é‡åŒ–<br>Query Embedding]
        B3 --> B4[ç›¸ä¼¼æ€§æ£€ç´¢<br>Similarity Search]
        B4 --> C1[é‡æ’åº<br>Re-ranking]
        C1 --> D1[ç»„åˆæŸ¥è¯¢ä¸ä¸Šä¸‹æ–‡]
        D1 --> D2[LLMç”Ÿæˆå›ç­”<br>Large Language Model]
        D2 --> D3[âœ… è¿”å›æœ€ç»ˆç­”æ¡ˆ]
    end
    
    %% è¿æ¥å·¦ä¾§å’Œä¸­é—´åˆ—
    A5 --> DB
    
    %% è¿æ¥ä¸­é—´åˆ—å’Œå³ä¾§åˆ—
    DB --> B4
    
    %% æ ·å¼å®šä¹‰
    classDef docProcess fill:#E3F2FD,stroke:#0D47A1,stroke-width:2px,color:#0D47A1;
    classDef vectorDB fill:#FFEBEE,stroke:#C62828,stroke-width:2px,color:#C62828;
    classDef queryProcess fill:#E8F5E9,stroke:#2E7D32,stroke-width:2px,color:#2E7D32;
    classDef rerankProcess fill:#FFF8E1,stroke:#FF8F00,stroke-width:2px,color:#FF8F00;
    classDef responseProcess fill:#F3E5F5,stroke:#4A148C,stroke-width:2px,color:#4A148C;
    
    %% åº”ç”¨æ ·å¼
    class A1,A2,A3,A4,A5 docProcess;
    class DB vectorDB;
    class B1,B2,B3,B4 queryProcess;
    class C1,C2 rerankProcess;
    class D1,D2,D3 responseProcess;
```

## ğŸ”§ é…ç½®è¯´æ˜

### æ¨¡å‹é…ç½®
- **åµŒå…¥æ¨¡å‹**: `shibing624/text2vec-base-chinese` (ä¸­æ–‡ä¼˜åŒ–)
- **é‡æ’æ¨¡å‹**: `cross-encoder/mmarco-mMiniLMv2-L12-H384-v1`
- **LLM æ¨¡å‹**: `deepseek-chat` (é€šè¿‡ DeepSeek API)

### æ–‡æœ¬åˆ†å—å‚æ•°
- **å—å¤§å°**: 150 å­—ç¬¦
- **é‡å å¤§å°**: 30 å­—ç¬¦
- **åˆ†éš”ç¬¦**: æ®µè½ > å¥å­ > å•è¯ > å­—ç¬¦

### æ£€ç´¢å‚æ•°
- **å¬å›æ•°é‡**: 10 æ¡
- **é‡æ’æ•°é‡**: 5 æ¡
- **ç›¸ä¼¼åº¦é˜ˆå€¼**: åŠ¨æ€è®¡ç®—

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ `main.py` ä¸­æ·»åŠ æ–°çš„ API ç«¯ç‚¹
2. åœ¨å‰ç«¯ `templates/index.html` ä¸­æ·»åŠ ç›¸åº”ç•Œé¢
3. æ›´æ–°æ–‡æ¡£å’Œæµ‹è¯•

### è‡ªå®šä¹‰æ¨¡å‹
ä¿®æ”¹ `main.py` ä¸­çš„æ¨¡å‹é…ç½®ï¼š
```python
# æ›´æ¢åµŒå…¥æ¨¡å‹
embedding_model = SentenceTransformer('your-model-name')

# æ›´æ¢é‡æ’æ¨¡å‹  
reranker = CrossEncoder('your-reranker-model')

# æ›´æ¢ LLM æœåŠ¡
async def stream_llm(messages):
    # å®ç°è‡ªå®šä¹‰ LLM è°ƒç”¨
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ™ è‡´è°¢

- [FastAPI](https://fastapi.tiangolo.com/) - ä¼˜ç§€çš„ Python Web æ¡†æ¶
- [ChromaDB](https://www.trychroma.com/) - è½»é‡çº§å‘é‡æ•°æ®åº“
- [Sentence Transformers](https://www.sbert.net/) - æ–‡æœ¬åµŒå…¥æ¨¡å‹
- [DeepSeek](https://platform.deepseek.com/) - å¤§è¯­è¨€æ¨¡å‹æœåŠ¡
- [Font Awesome](https://fontawesome.com/) - å›¾æ ‡åº“

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ [GitHub Issue](https://github.com/Anthonybuer182/ai-chat-rag/issues)

## ğŸ¯ è·¯çº¿å›¾

- [ ] æ”¯æŒå¤šè¯­è¨€ç•Œé¢
- [ ] æ”¯æŒæ›´å¤šæ–‡ä»¶æ ¼å¼è§£æ
- [ ] é›†æˆæ›´å¤š LLM æä¾›å•†
- [ ] æ”¯æŒè‡ªä¸»é…ç½®æ¨¡å‹å‚æ•°


---

**æ³¨æ„**: ä½¿ç”¨å‰è¯·ç¡®ä¿å·²é…ç½®æ­£ç¡®çš„ API å¯†é’¥ï¼Œå¹¶éµå®ˆç›¸å…³æœåŠ¡çš„ä½¿ç”¨æ¡æ¬¾ã€‚

**æ³æ±‚**: â¤ï¸å–œæ¬¢ai-chat-ragè¿™ä¸ªé¡¹ç›®ï¼Ÿé‚£å°±ç»™å®ƒæ˜Ÿæ˜ŸğŸŒŸå§